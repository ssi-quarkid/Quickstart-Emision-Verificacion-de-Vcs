"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const hex_1 = require("../../../format/hex");
const combinators_1 = require("../common/combinators");
const common_1 = require("../common/common");
const encoding_1 = require("../common/encoding");
const errors_1 = require("../common/errors");
const flow_control_1 = require("../common/flow-control");
const types_1 = require("../common/types");
const bch_errors_1 = require("./bch-errors");
const bch_opcodes_1 = require("./bch-opcodes");
const bch_types_1 = require("./bch-types");
exports.opCat = () => (state) => combinators_1.useTwoStackItems(state, (nextState, [a, b]) => a.length + b.length > common_1.ConsensusCommon.maximumStackItemLength
    ? errors_1.applyError(bch_errors_1.AuthenticationErrorBCH.exceededMaximumStackItemLength, nextState)
    : combinators_1.pushToStack(nextState, hex_1.flattenBinArray([a, b])));
exports.opSplit = ({ requireMinimalEncoding, }) => (state) => combinators_1.useOneScriptNumber(state, (nextState, value) => {
    const index = Number(value);
    return combinators_1.useOneStackItem(nextState, (finalState, [item]) => index < 0 || index > item.length
        ? errors_1.applyError(bch_errors_1.AuthenticationErrorBCH.invalidSplitIndex, finalState)
        : combinators_1.pushToStack(finalState, item.slice(0, index), item.slice(index)));
}, { requireMinimalEncoding });
var Constants;
(function (Constants) {
    Constants[Constants["positiveSign"] = 0] = "positiveSign";
    Constants[Constants["negativeSign"] = 128] = "negativeSign";
})(Constants || (Constants = {}));
exports.padMinimallyEncodedScriptNumber = (scriptNumber, length) => {
    // eslint-disable-next-line functional/no-let
    let signBit = Constants.positiveSign;
    // eslint-disable-next-line functional/no-conditional-statement
    if (scriptNumber.length > 0) {
        // eslint-disable-next-line functional/no-expression-statement, no-bitwise
        signBit = scriptNumber[scriptNumber.length - 1] & Constants.negativeSign;
        // eslint-disable-next-line functional/no-expression-statement, no-bitwise, functional/immutable-data
        scriptNumber[scriptNumber.length - 1] &= Constants.negativeSign - 1;
    }
    const result = Array.from(scriptNumber);
    // eslint-disable-next-line functional/no-loop-statement
    while (result.length < length - 1) {
        // eslint-disable-next-line functional/no-expression-statement, functional/immutable-data
        result.push(0);
    }
    // eslint-disable-next-line functional/no-expression-statement, functional/immutable-data
    result.push(signBit);
    return Uint8Array.from(result);
};
exports.opNum2Bin = () => (state) => combinators_1.useOneScriptNumber(state, (nextState, value) => {
    const targetLength = Number(value);
    return targetLength > common_1.ConsensusCommon.maximumStackItemLength
        ? errors_1.applyError(bch_errors_1.AuthenticationErrorBCH.exceededMaximumStackItemLength, nextState)
        : combinators_1.useOneScriptNumber(nextState, (finalState, [target]) => {
            const minimallyEncoded = types_1.bigIntToScriptNumber(target);
            return minimallyEncoded.length > targetLength
                ? errors_1.applyError(bch_errors_1.AuthenticationErrorBCH.insufficientLength, finalState)
                : minimallyEncoded.length === targetLength
                    ? combinators_1.pushToStack(finalState, minimallyEncoded)
                    : combinators_1.pushToStack(finalState, exports.padMinimallyEncodedScriptNumber(minimallyEncoded, targetLength));
        }, {
            maximumScriptNumberByteLength: 
            // TODO: is this right?
            common_1.ConsensusCommon.maximumStackItemLength,
            requireMinimalEncoding: false,
        });
}, { requireMinimalEncoding: true });
exports.opBin2Num = () => (state) => combinators_1.useOneScriptNumber(state, (nextState, [target]) => {
    const minimallyEncoded = types_1.bigIntToScriptNumber(target);
    return minimallyEncoded.length > common_1.ConsensusCommon.maximumScriptNumberLength
        ? errors_1.applyError(bch_errors_1.AuthenticationErrorBCH.exceededMaximumScriptNumberLength, nextState)
        : combinators_1.pushToStack(nextState, minimallyEncoded);
}, {
    // TODO: is this right?
    maximumScriptNumberByteLength: common_1.ConsensusCommon.maximumStackItemLength,
    requireMinimalEncoding: false,
});
exports.bitwiseOperation = (combine) => (state) => combinators_1.useTwoStackItems(state, (nextState, [a, b]) => a.length === b.length
    ? combinators_1.pushToStack(nextState, combine(a, b))
    : errors_1.applyError(bch_errors_1.AuthenticationErrorBCH.mismatchedBitwiseOperandLength, nextState));
exports.opAnd = () => exports.bitwiseOperation((a, b) => a.map((v, i) => v & b[i]));
exports.opOr = () => exports.bitwiseOperation((a, b) => a.map((v, i) => v | b[i]));
exports.opXor = () => exports.bitwiseOperation((a, b) => a.map((v, i) => v ^ b[i]));
exports.opDiv = ({ requireMinimalEncoding, }) => (state) => combinators_1.useTwoScriptNumbers(state, (nextState, [a, b]) => b === BigInt(0)
    ? errors_1.applyError(bch_errors_1.AuthenticationErrorBCH.divisionByZero, nextState)
    : combinators_1.pushToStack(nextState, types_1.bigIntToScriptNumber(a / b)), { requireMinimalEncoding });
exports.opMod = ({ requireMinimalEncoding, }) => (state) => combinators_1.useTwoScriptNumbers(state, (nextState, [a, b]) => b === BigInt(0)
    ? errors_1.applyError(bch_errors_1.AuthenticationErrorBCH.divisionByZero, nextState)
    : combinators_1.pushToStack(nextState, types_1.bigIntToScriptNumber(a % b)), { requireMinimalEncoding });
/**
 * Validate the encoding of a raw signature â€“ a signature without a signing
 * serialization type byte (A.K.A. "sighash" byte).
 *
 * @param signature - the raw signature
 */
exports.isValidSignatureEncodingBCHRaw = (signature) => signature.length === 0 ||
    signature.length === bch_types_1.ConsensusBCH.schnorrSignatureLength ||
    encoding_1.isValidSignatureEncodingDER(signature);
exports.opCheckDataSig = ({ secp256k1, sha256, }) => (state) => 
// eslint-disable-next-line complexity
combinators_1.useThreeStackItems(state, (nextState, [signature, message, publicKey]) => {
    if (!exports.isValidSignatureEncodingBCHRaw(signature)) {
        return errors_1.applyError(errors_1.AuthenticationErrorCommon.invalidSignatureEncoding, nextState);
    }
    if (!encoding_1.isValidPublicKeyEncoding(publicKey)) {
        return errors_1.applyError(errors_1.AuthenticationErrorCommon.invalidPublicKeyEncoding, nextState);
    }
    const digest = sha256.hash(message);
    const useSchnorr = signature.length === bch_types_1.ConsensusBCH.schnorrSignatureLength;
    const success = useSchnorr
        ? secp256k1.verifySignatureSchnorr(signature, publicKey, digest)
        : secp256k1.verifySignatureDERLowS(signature, publicKey, digest);
    return !success && signature.length !== 0
        ? errors_1.applyError(errors_1.AuthenticationErrorCommon.nonNullSignatureFailure, nextState)
        : combinators_1.pushToStack(nextState, types_1.booleanToScriptNumber(success));
});
exports.opCheckDataSigVerify = ({ secp256k1, sha256, }) => combinators_1.combineOperations(exports.opCheckDataSig({ secp256k1, sha256 }), flow_control_1.opVerify());
exports.bitcoinCashOperations = ({ flags, secp256k1, sha256, }) => ({
    [bch_opcodes_1.OpcodesBCH.OP_CAT]: exports.opCat(),
    [bch_opcodes_1.OpcodesBCH.OP_SPLIT]: exports.opSplit(flags),
    [bch_opcodes_1.OpcodesBCH.OP_NUM2BIN]: exports.opNum2Bin(),
    [bch_opcodes_1.OpcodesBCH.OP_BIN2NUM]: exports.opBin2Num(),
    [bch_opcodes_1.OpcodesBCH.OP_AND]: exports.opAnd(),
    [bch_opcodes_1.OpcodesBCH.OP_OR]: exports.opOr(),
    [bch_opcodes_1.OpcodesBCH.OP_XOR]: exports.opXor(),
    [bch_opcodes_1.OpcodesBCH.OP_DIV]: exports.opDiv(flags),
    [bch_opcodes_1.OpcodesBCH.OP_MOD]: exports.opMod(flags),
    [bch_opcodes_1.OpcodesBCH.OP_CHECKDATASIG]: exports.opCheckDataSig({
        secp256k1,
        sha256,
    }),
    [bch_opcodes_1.OpcodesBCH.OP_CHECKDATASIGVERIFY]: exports.opCheckDataSigVerify({ secp256k1, sha256 }),
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmNoLW9wZXJhdGlvbnMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9zcmMvbGliL2F1dGgvaW5zdHJ1Y3Rpb24tc2V0cy9iY2gvYmNoLW9wZXJhdGlvbnMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFDQSw2Q0FBc0Q7QUFNdEQsdURBUStCO0FBQy9CLDZDQUFtRDtBQUNuRCxpREFHNEI7QUFDNUIsNkNBQXlFO0FBQ3pFLHlEQUFrRDtBQUNsRCwyQ0FBOEU7QUFFOUUsNkNBQXNEO0FBQ3RELCtDQUEyQztBQUMzQywyQ0FBMkM7QUFFOUIsUUFBQSxLQUFLLEdBQUcsR0FFakIsRUFBRSxDQUFDLENBQUMsS0FBWSxFQUFFLEVBQUUsQ0FDdEIsOEJBQWdCLENBQUMsS0FBSyxFQUFFLENBQUMsU0FBUyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FDNUMsQ0FBQyxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsTUFBTSxHQUFHLHdCQUFlLENBQUMsc0JBQXNCO0lBQzFELENBQUMsQ0FBQyxtQkFBVSxDQUNSLG1DQUFzQixDQUFDLDhCQUE4QixFQUNyRCxTQUFTLENBQ1Y7SUFDSCxDQUFDLENBQUMseUJBQVcsQ0FBQyxTQUFTLEVBQUUscUJBQWUsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQ3BELENBQUM7QUFFUyxRQUFBLE9BQU8sR0FBRyxDQUVyQixFQUNBLHNCQUFzQixHQUd2QixFQUFFLEVBQUUsQ0FBQyxDQUFDLEtBQVksRUFBRSxFQUFFLENBQ3JCLGdDQUFrQixDQUNoQixLQUFLLEVBQ0wsQ0FBQyxTQUFTLEVBQUUsS0FBSyxFQUFFLEVBQUU7SUFDbkIsTUFBTSxLQUFLLEdBQUcsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQzVCLE9BQU8sNkJBQWUsQ0FBQyxTQUFTLEVBQUUsQ0FBQyxVQUFVLEVBQUUsQ0FBQyxJQUFJLENBQUMsRUFBRSxF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